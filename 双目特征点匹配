


0、分别使用单目Frame的构造函数对四个校正后的鱼眼图像进行封装。匹配函数一次只对具有重叠区域的两个Frame进行操作，由于可以组成四对Frame，所以需要调用四次。

1、匹配函数的参数是两个Frame类对象，第一个参数是左目Frame，第二个参数是右目Frame。

2、首先，根据右目特征点的y坐标和尺度r建立右目的行查找表，例如y=10.1，r=1.2，则认为右目的第9,10,11行都包含该特征点，即从一行变为一条搜索带。注意，由于只有右目的左半部分与左目的右半部分重叠，所以建立查找表时跳过右目中位于右半部分的特征点，减少误匹配。

3、遍历左目的所有特征点，跳过位于左半部分的特征点（与右目没有重叠），根据左目特征点的y坐标从行查找表中取出右目对应行的所有候选特征点。

  （1）如果没有候选特征点，则跳过当前左目特征点，取出下一个左目特征点。

  （2）如果有候选特征点，对每个候选特征点进行初步筛选（这里认为同一特征点应该具体相似的尺度和方向）:

            ①左目当前特征点的尺度与当前候选特征点的尺度差异小（这里设为3）;

            ②左目当前特征点的方向角度与当前候选特征点的方向角度差异小（这里设为15）。

  （3）如果没有候选特征点通过上述筛选，则取出下一个左目特征点。否则，保留其中与左目当前特征点的特征描述子距离最小的候选特征点及其最小距离。

  （4）使用特征描述子的距离阈值（这里使用ORB_SLAM2的默认参数）对上述最小距离进行筛选。如果通过筛选，根据左目当前特征点的尺度对特征点的坐标进行缩放，并从左目图像金字塔相应位置取出缩放后的图像，对右目候选特征点进行同样的操作，计算ZNCC相似度，设定阈值（最大值为1，这里设为0.9）利用ZNCC值进行筛选。

  （5）(ORB_SLAM2的原做法)
    如果通过ZNCC的筛选，固定左目当前特征点的位置，使用滑动窗口对候选特征点进行左右滑动，计算窗口间像素值的L1距离，并将所有滑动经过的L1距离值存入数组，以及记录L1最小值出现的位置。

    如果数组中的值单调递增或单调递减，则跳过当前左目特征点。否则认为数组中的值呈现抛物线趋势（原作者认为正确匹配的位置L1值最小，随着偏移的增大L1值逐渐增大），取出谷底和左右相邻的点，三个点可以拟合抛物线方程，得到抛物线谷底对应的x坐标偏移值。

    如果该偏移值大于一个像素，则跳过当前左目特征点。否则将该偏移值以及上述L1最小值出现的位置作为x坐标的修正量。

  （6）保存通过所有筛选的匹配点对、特征描述子距离并计算深度。

4、（ORB_SLAM2的原做法）
    最后，对所有保存的特征描述子距离进行排序，取出距离中值，再乘以相关系数，作为距离阈值再次进行筛选（前面已经进行过一次距离阈值筛选），对没有通过筛选的匹配点对，将第3步6)中保存的相应值擦除。


总结: 

主要使用了以下筛选策略：

y差异小、正视差（第2步）、尺度差异小、方向差异小（第3步(2)）、特征描述子匹配距离最小（第3步(3)）、特征描述子距离尽可能小（第3步(4)）、候选点相邻区域符合抛物线趋势、抛物线中心偏移值小(第3步(5)）、特征描述子距离尽可能小（第4步）



